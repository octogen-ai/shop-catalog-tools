# Octogen Shop Catalog Tools

This repository contains tools to download and work with the Octogen shopping catalogs. The instructions here have been tested on MacOS, but
not on Windows.

## Getting Started

### 1.A Install UV

Please follow instructions [here](https://docs.astral.sh/uv/getting-started/installation/) for your platform.


### 1.B Install Duckdb (for catalog analytics) 

```
brew install duckdb
```

### 2. Setup environment

Create a `.env` file in the root directory with the following env vars.
Please obtain the customer name and service account credentials file from your Octogen Account rep.

```
OCTOGEN_CATALOG_BUCKET_NAME=octogen-catalog-exchange
OCTOGEN_CUSTOMER_NAME=<octogen-customer-name>
GOOGLE_APPLICATION_CREDENTIALS=<Path to the Service Account credentials file>
DB_ENGINE=duckdb
```

### 3. Process the catalog

You have two options to process a catalog:

#### Option A: Single Command (Recommended)
Run all steps (download, load to database, and index) with a single command:
```bash
uv run src/process_catalog.py --catalog anntaylor --db-type duckdb
uv run src/process_catalog.py --catalog heydude --db-type duckdb
uv run src/process_catalog.py --catalog chairish --db-type duckdb
```

This will:
1. Download the catalog to `/tmp/octogen-catalog-exchange`
2. Create a SQLite database named `anntaylor_catalog.db` (or a duckdb database named `anntaylor_catalog.duckdb` for catalog analytics. See addendum for more details)
3. Create a Whoosh index at `/tmp/whoosh/anntaylor`

You can customize any of these paths:
```bash
uv run src/process_catalog.py --catalog anntaylor --download /custom/path --index_dir /custom/index/path
```

#### Option B: Individual Steps
Alternatively, you can run each step individually:

1. Download the catalog:
```bash
uv run src/octogen_catalog.py --catalog anntaylor --download /tmp/octogen-catalog-exchange
```

2. Extract the data to a database:
```bash
uv run src/load_to_db.py --catalog anntaylor --download /tmp/octogen-catalog-exchange
```

3. Index the data:
```bash
uv run src/index_catalog.py --table_name anntaylor
```

### 8. Run a sample UI! 

I've included a sample UI in `src/app/src/App.svelte`. To run it, you can use the following command.

First, you will need to make sure you have installed `npm`: 
```
brew install npm
```

Then run the shell script, which will install all dependencies and start the FastAPI server and the Svelte server:

```
chmod +x run_api_and_svelte_server.sh
./run_api_and_svelte_server.sh
```

This should output something like:
```
  VITE v5.4.11  ready in 293 ms

  ➜  Local:   http://localhost:5173/
  ➜  Network: use --host to expose
INFO:     127.0.0.1:53403 - "GET /api/anntaylor/products?page=1&per_page=100 HTTP/1.1" 200 OK
```
Open up your browser and go to the URL generated by the script, e.g. `http://localhost:5173/`. You should see a list of products. You can click on the product to see variants
etc.

### 4. Query the data with Sqllite
I used https://sqlitebrowser.org/, which I installed via `brew install sqlitebrowser`.

```
brew install sqlitebrowser
```
Open the application and select the database file `anntaylor_catalog.db`. 

The datastructure for each product is simple: a `product_url`, `id`, `name` and `extracted_product` json column/field that has all of the
attributes. 

The schema for `extracted_product` is in `src/schema.py` and a json version of it is in `src/schema.json`.

### 5. Alternative query: read structured products 

We've also included a script to read the structured products into a pandas dataframe and print them out in tabular format:
```
uv run src/read_structured_products.py --catalog anntaylor --db_path anntaylor_catalog.db
```
## Addendum

### 1. DuckDB

To see catalog analytics, you to use DuckDB instead of SQLite, you can do so by setting the `DB_ENGINE` environment variable to `duckdb` in your `.env` file.

You can then specify the database type:
```bash
uv run src/process_catalog.py --catalog anntaylor --db-type duckdb
```
You can also run it against local files, that may have been downloaded previously:
```bash
uv run src/process_catalog.py --catalog anntaylor --download /path/to/local/files --local
```
